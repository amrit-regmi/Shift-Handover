<!DOCTYPE html>
<!-- saved from url=(0021)http://www.samco.aero/ -->
<html lang="en">
<head>
  <title>Shift Handover Form - SAMCO Aircraft Maintenance</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.0-alpha14/css/tempusdominus-bootstrap-4.min.css" />

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
 
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css"/> 


<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
 
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.js"></script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.0-alpha14/js/tempusdominus-bootstrap-4.min.js"></script>
 
 <style>

 .timesheet_table th {
    position: sticky;
    top: 55px;
    position: sticky;
    z-index: 1;
    background-color: #ffc107;
	color:white
}


 .btn-group-xs > .btn, .btn-xs {
    padding  : .25rem .4rem;
    font-size  : .875rem;
    line-height  : .5;
    border-radius : .2rem;
}
 
input[type=checkbox] {
  transform: scale(1.5);
}

textarea{
  resize: vertical;

}

.newhandover,.viewhandover{
    margin-bottom: 2rem;
    background-color: #e9ecef;
	padding:2rem
}

.error{
	border:3px solid red;
}
.errormessage{
	color: red;
	font-size: small;
	margin-left:0.2rem;
}


.workAircraft{
float:left;
width:12%;
}

 tr td{
  
  margin: 0 !important;
  text-align: centre; 
  vertical-align: middle;
  line-height:100%;
  border-bottom: 1px solid #dee2e6
  
	
}

.card-body{
  padding: 0 !important;
  margin: 0.5rem !important;
}

.newhandover.workAircraftExpand{
float:left;
width:100%;
margin-bottom:2rem;
}

.actionUser .form-control{
padding:0.15rem 0.5rem !important;
font-size: 0.75rem;

}

.actionUser{
margin-left: 0.3rem;
}

.table{
margin: 0.1rem ;

}
.alert{
margin-bottom:0.3rem;
}

.loader{
  display:none;
  text-align:center;
  background-color: transparent;
  z-index:15
  
}

#loading_text{
  font-size: 50px;
  color: #e0810d;
  margin-top:10px;
}

.spinner {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  position: relative;
  left: 40%;
  top: 40%;
  z-index: 1;
  width: 150px;
  height: 150px;
  -webkit-animation: spin 2s linear infinite; /* Safari */
  animation: spin 2s linear infinite;
  margin-top:50px;
}
.overlay{
    bottom: 0;
    position: absolute;
    top: 0;
    height: 100%;
    width: 100%;
    background: transparent;
    z-index: 100;
}
/* Safari */
@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.successAlert{
    POSITION: fixed;
    TOP: 0;
    right: 0;
    left: 0;
    height: 100%;
    width: 100%;
    background-color: rgba(0,0,0,0.8);
	text-align:center;
	display:none;
	z-index:101;

}
.version{
    font-size: 0.5rem;
    float: right;
    margin-right: 0.5rem
	}

.popovernote{
	line-height: 0.5rem;
	padding:0rem 0.5rem 0rem 0.5rem !important;
}
.actionrequired{
    padding: 0.5rem;
    margin-block-end: 1rem;
    border-bottom: 2px solid #3d34c733;
}
.menubar, .searchBar{
	position: sticky;
    top: 0px;
    z-index: 5;
    background-color: white;
    border-bottom: #007bff solid 2px;
    padding: 0.5rem 0rem 0.5rem 0rem;
	margin-bottom: 0.1rem;
}
.customAlert{
    position: sticky !important;
    top: 3rem;
    z-index: 10;
	margin-bottom: 0.1rem;
}
[id|=staff_name]{
	padding:0.25rem 0.375rem !important;
	font-size: 0.75rem;
}
.delete_Row{
    transform: scale(1.5);
}

.toNextShift::after{
	content: "Continued to Next Shift";
}
.fromLastShift::after{
	content: "Continued from Last Shift";
}
.autocomplete {
  /*the container must be positioned relative:*/
  position: relative;
  display: inline-block;
}

.autocomplete-items {
  position: absolute;
  border: 1px solid #d4d4d4;
  border-bottom: none;
  border-top: none;
  z-index: 99;
  /*position the autocomplete items to be the same width as the container:*/
  top: 100%;
  left: 0;
  right: 0;
}
.autocomplete-items div {
  padding: 10px;
  cursor: pointer;
  background-color: #fff; 
  border-bottom: 1px solid #d4d4d4; 
}
.autocomplete-items div:hover {
  /*when hovering an item:*/
  background-color: #e9e9e9; 
}
.autocomplete-active {
  /*when navigating through the items using the arrow keys:*/
  background-color: DodgerBlue !important; 
  color: #ffffff; 
}
.circle {
	border-radius: 50.1px;
    background-color: white;
    position: absolute;
    top: -0.5px;
    margin-left: 8px;
    z-index: 1;
    min-width: 100px;
    min-height: 101px;
}
.header{
background:url("http://drive.google.com/uc?export=view&id=18m3H7MZf7wRnWYdPamdbsRimd6bhcVEY");
background-repeat:no-repeat;
background-size: 100%;
}

#station:hover a.resetStation:after{
	content: "Reset"
}
</style>
 
  
</head>
<body class="bg-white">


<div class="container ">


<div class ="content">

	
<div class="top-navbar float-right">
	<button  class="btn btn-xs btn-info handoverHome"  style="display:none"><i class="fa fa-chevron-left" aria-hidden="true"></i> Back to Handover</button>
	<button  class="btn btn-xs btn-info browseTimeSheets">TimeSheets <i class="fas fa-user-clock"></i></button>
	<button  class="btn btn-xs btn-info browseHandover" >Old Handovers <i class="fa fa-history"></i></button>
	<button  class="btn btn-xs btn-info help" > Instructions <i class="fas fa-question-circle"></i></button>
</div>
  <div class="header clearfix">
<!--<div class="logo" style="width: 100%;height: 100px;/* position: relative; */">
<div style="
    /* w: 125px; */
    /* top: -103px; */
    height: 100px;
    background-color:white;
    width: fit-content;
" class="hex"><div style="
    border-radius: 50px;
    background-color: white;
    position: relative;
    top: 1px;
    margin-left: 8px;
    z-index: 1;
    width: 100px;
    min-height: 101px;
    "></div><div class="left" style="
    position: relative;
    margin-top: -99px;
    float: left;
    width: 0;
    border-top: 50px solid transparent;
    border-bottom: 50px solid transparent;
    border-left: 0px solid transparent;
    border-right: 30px solid #e0810d;
"></div><div class="center" style="
    position: relative;
    margin-top: -99px;
    float: left;
    width: 57px;
    background: #e0810d;
    height: 100%;
    /* display: inline-block; */
"></div><div class="right" style="position: relative;margin-top: -99px;float: left;width: 0;border-top: 50px solid transparent;border-bottom: 50px solid transparent;border-left: 30px solid #e0810d;/* border-right: 80px solid transparent; */"></div>
</div><div class="aeroplane" style="
    z-index: 2;
    height: 38px;
    width: 85px;
    /* border: 1px solid black; */
    position: relative;
    transform: rotate(-17deg);
    top: -65px;
    margin-left: 14px;
"><div style="
    /* position: relative; */
    float: left;
    /* top: 34px; */
    border-left: 16px solid black;
    border-top: 2px solid transparent;
    margin-top: 11px;
    /* width: 5px; */
"></div>
<div style="z-index: 5;float: left;margin-top: 3px;height: 0px;/* transform: rotate(-6deg); *//* bottom: -13px; *//* border-right: 7px solid black; */border-bottom: 10px solid transparent;border-right: 5px solid black;border-top: 0px solid transparent;/* margin-left: 10px; *//* margin-top: 0%; */"></div><div style="
    /* position: relative; */
    z-index: 5;
    margin-top: 3px;
    float: left;
    height: 0px;
    /* transform: rotate(-6deg); */
    /* bottom: -13px; */
    border-left: 10px solid black;
    /* border-bottom: 3px solid black; */
    /* border-right: 44px solid transparent; */
    border-top: 10px solid transparent;
    /* margin-left: 10px; */
    /* margin-top: 0%; */
"></div>
<div style="
    float: left;
    margin-left: -12px;
    border-left: 43px solid transparent;
    border-bottom: 4px solid black;
    z-index: 3;
    width: -41px;
    margin-top: 6px;
"></div><div style="
    margin-top: 10px;
    float: left;
    height: 3px;
    border: 1.5px solid black;
    margin-left: -33px;
    /* border-left: 40px solid transparent; */
    /* border-bottom: 5px solid #050505d9; */
    z-index: 3;
    width: 33px;
"></div><div style="
    margin-top: 6px;
    /* margin-left: 11px; */
    float: left;
    border-top: 4.7px solid transparent;
    border-left: 10px solid black;
    border-bottom: 2.5px solid transparent;
    /* width: 6px; */
    /* background: black; */
    /* height: 3px; */
    /* border-radius: 0 100% 100% 0; */
"><div></div></div></div><div class="texts" style="
    position: relative;
    top: -134px;
    margin-left: 118px;
    height: 100%;
    background: white;
    width: fit-content;
"><div class="LogoTitle" style="
    /* border-bottom: 3px solid #e0810d; */
    position: relative;
    /* height: 35px; */
    /* margin-left: -56px; */
    left: -30px;
    z-index: 5;
    /* background: white; */
    font-size: 32PX;
    font-weight: bold;
    font-stretch: expanded;
    font-kerning: normal;
    LINE-HEIGHT: 45PX;
    top: 13px;
    width: 170px;
    ">SAMCO</div><div class="LogoTitle" style="
    position: relative;
    height: 103px;
    top: -58px;
    margin-left: 15px;
    left: -34px;
    padding-left: 7px;
    /* border-top: 3px solid #e0810d; */
    z-index: 4;
    background: white;
    font-size: 16PX;
    font-weight: bold;
    /* font-stretch: ultra-expanded; */
    font-kerning: normal;
    LINE-HEIGHT: 158PX;
    color: #e0810d;
    width: fit-content;
">Aircraft Maintenance</div><div style="
    /* position: relative; */
    margin-top: -160px;
    margin-left: -145px;
    z-index: 1;
">
<div style="
    border-radius: 50.1px;
    background-color: white;
    position: relative;
    top: -1px;
    left: 195px;
    z-index: 3;
    width: 100px;
    min-height: 100px;
    "></div><div style="
    position: relative;
    margin-top: -101px;
    left: 271px;
    width: 0;
    border-top: 51px solid transparent;
    border-bottom: 48px solid transparent;
    border-right: 0px solid transparent;
    border-left: 30px solid #e0810d;
    z-index: 2;
"></div></div></div>
<div style="
    height: 2px;
    background: #e0810d;
    position: relative;
    top: -180px;
    width: -webkit-fill-available;
    z-index: 13;
    margin-left: 85px;
"></div></div>!-->
             <img src="http://drive.google.com/uc?export=view&id=18m3H7MZf7wRnWYdPamdbsRimd6bhcVEY"  alt="logo" style="width:100%;visibility:hidden;margin-bottom: -15px;" id="banner" />
			 <div class="float-right title"><h3>Line Maintenance Shift Handover <br><span style="font-size: 0.8rem;float: left;" class="badge badge-dark" id="station"><a class="resetStation" href="#" style="font-weight: normal;"></a></span><span class="version"> version 2.02</span></h3></div>
  </div>
<div class="menubar" style="display:none">
	
	<button  class="btn btn-sm btn-primary  BackHandoverBtn"  style="display:none"><i class="fas fa-chevron-left" aria-hidden="true"></i> Back </button>
	<button  class="btn btn-sm btn-primary NewHandoverBtn" style="display:none" ><i class="fas fa-file-text" aria-hidden="true"></i> Create New </button>
	<div class ="float-right">
	<button  class="btn btn-sm btn-primary ResetHandoverBtn " style="display:none" ><i class="fas fa-retweet" aria-hidden="true"></i> Reset </button>
	
	<button  class="btn btn-sm btn-primary LoadHandoverBtn " style="display:none" ><i class="fas fa-copy" aria-hidden="true"></i> Load</button>
	
	<button  class="btn btn-sm btn-primary SaveHandoverBtn" style="display:none" ><i class="fas fa-floppy-o" aria-hidden="true"></i> Save </button>
	</div>
	
</div>

<div class="searchBar" style="display:none">
<div class="searchBar_button">
	<div class="form-inline " style="width:100%">
		<div class="autocomplete">
			<input type="text" id="search_name" class="form-control-sm" name="search_name" required="" placeholder="Enter Staff Name"style="margin-right: 10px">
			<input type="password" id="pin" class="form-control-sm" name="pin" required="" placeholder="Enter Pin or Master Pin "style="margin-right: 10px">
		</div>

		<div class="dropdown month" id="month" style="margin-right: 10px">
		  <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown">
			Select Month
		  </button>
		  <div class="dropdown-menu">
			
		  </div>
		</div>
		<button  class="btn btn-sm btn-primary search" style="margin-right: 10px"><i class="fas fa-search" aria-hidden="true"></i> Get Timesheet </button>
		
		<button  class="btn btn-sm btn-primary getPin " style="margin-right: 10px" title="Needs Master Pin, contact station supervisor for Pin"><i class="fas fa-key"></i> Get Pin for Selected User  </button>
		
	</div>
	</div>
	</div>
 <div class="dataBrowser" name = "dataBrowser" style="display:none;">	
 </div>	
	<div class="loader">
		<div class="overlay"></div>
		<div class="spinner"></div>
		<h1 id="loading_text"> Please wait while loading</h1>
    </div>
	 <div class="main">
  <div class="chooseStation">
  <div class="jumbotron">
  <h1 class="display-5">Choose Station</h1>
  <hr class="my-4">
  <div class="stationRadioButtons stationselect">
	<div class="form-check form-check-inline">
	  <input class="form-check-input" type="radio" name="radioButtonStation" id="inlineRadio1" value="CPH">
	  <label class="form-check-label" for="inlineRadio1">CPH  </label>
	</div>
	<div class="form-check form-check-inline">
	  <input class="form-check-input" type="radio"name="radioButtonStation" id="inlineRadio2" value="ARN">
	  <label class="form-check-label" for="inlineRadio2">ARN  </label>
	</div>
	<div class="form-check form-check-inline">
	  <input class="form-check-input" type="radio" name="radioButtonStation" id="inlineRadio3" value="TRD">
	  <label class="form-check-label" for="inlineRadio3">TRD  </label>
	</div>
	<div class="form-check form-check-inline">
	  <input class="form-check-input" type="radio" name="radioButtonStation" id="inlineRadio3" value="OSL">
	  <label class="form-check-label" for="inlineRadio3">OSL  </label>
	</div>
	<div class="form-check form-check-inline">
	  <input class="form-check-input" type="radio" name="radioButtonStation" id="inlineRadio3" value="HEL">
	  <label class="form-check-label" for="inlineRadio3">HEL  </label>
	</div>
	<div class="form-check form-check-inline">
	  <input class="form-check-input" type="radio" name="radioButtonStation" id="inlineRadio3" value="TLL">
	  <label class="form-check-label" for="inlineRadio3">TLL  </label>
	</div>
	<div class="form-check form-check-inline">
	  <input class="form-check-input" type="radio" name="radioButtonStation" id="inlineRadio3" value="GEV">
	  <label class="form-check-label" for="inlineRadio3">GEV  </label>
	</div>
	</div>
	
	<hr class="my-4">
	
	<div class="custom-control custom-checkbox">
	  <input type="checkbox" class="custom-control-input" id="remember" >
	  <label class="custom-control-label" for="remember" > Remember my selection and do not show this page next time </label>
	</div>
	<hr class="my-4">	
	<p class="lead">
    <button class="btn btn-primary btn-lg" id="chooseStation" >Next</button>
  </p>
</div>
</div>
  <div class="newhandover" style="display:none;">
	
	<div class="clearfix">
	<div class="card float-right" style="width:63%">
		<div class="card-header alert alert-primary">Staff</div>
		<div class="card-body">
		
		<table class="table">
				
				<tbody>
					<tr>
					<td>
					<div class="form-inline autocomplete">
					<div class="autocomplete float-left"  style="width: 39%;"><input style="width:100%;" type="text" id="n_staff_1" class="form-control" name="n_staff_name_1" required="" placeholder="Staff Name"></div>
					
					<div class="input-group date float-left" id="datetimepicker_s_1" data-target-input="nearest" style="margin-left: 0.1rem;width: 30%; display:inline-flex;" >
						<input id="n_staff_1_s" type="text" class="form-control datetimepicker-input" data-target="#datetimepicker_s_1" value="" placeholder="Start Time" />
						<div class="input-group-append" data-target="#datetimepicker_s_1" data-toggle="datetimepicker">
							<div class="input-group-text"><i class="far fa-clock"></i></div>
						</div>
					</div>
					
					<div class="input-group date float-left" id="datetimepicker_e_1" data-target-input="nearest" style="margin-left: 0.1rem;width: 30%;display:inline-flex;" >
						<input type="text" id="n_staff_1_e" class="form-control datetimepicker-input" data-target="#datetimepicker_e_1" value="" placeholder="End Time"/>
						<div class="input-group-append" data-target="#datetimepicker_e_1" data-toggle="datetimepicker">
							<div class="input-group-text"><i class="far fa-clock"></i></div>
						</div>
					</div>
					</div>
					</td>
					
					
					
					<td style="width:10%"></td> 
					</tr>
					
					<td style=" text-align: left; color:red ">Enter Start and End time only if different from Shift Start Time Or End Time</br><button type="button" class="btn btn-link add_Row" style="transform: scale(2);" onclick="false"><i class="fas fa-plus-circle"></i></button></td>
				</tr>
				</tbody>
			</table>
				
		</div>
	</div>
	<div class="card float-left alert alert-primary" style="width:35%;margin-bottom:1rem;">
		
		<div class="card-body">
			<div class="clockTime" style="
    font-size: x-large;
    font-weight: bold;
	
">DD.MM.YYYY HH:MM</div>
    
		</div>
	</div>
	
	<div class="card float-left" style="width:35%">
		<div class="card-header alert alert-primary">Shift start Date/Time</div>
		<div class="card-body">
			<table style="width:100%"><tr><td>
			<div class="form-group">
                <div class="input-group date" id="datetimepicker1" data-target-input="nearest">
                    <input type="text" id="start_time" class="form-control datetimepicker-input" data-target="#datetimepicker1" name="starttime" value=""  required>
                    <div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker">
                        <div class="input-group-text"><i class="far fa-calendar-alt"></i></div>
                    </div>
                </div>
            </div></td></tr></table>
		</div>
	</div></div>
	&nbsp;

	<div class="card border  border-primary shadow">
	<div class="card-header alert alert-primary">Work Performed on CityJet Fleet</div>
	<div class="card-body">
		<div class="checkbox workAircraft " id="fpa">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"  /> FPA</label>
		</div>
		<div class="checkbox workAircraft" id="fpb">
			<label><input class="aircraftSelect" id="expanded" type="checkbox" /> FPB</label>
		</div>
		<div class="checkbox workAircraft" id="fpc">
			<label><input class="aircraftSelect" id="expanded" type="checkbox" /> FPC</label>
		</div>
		<div class="checkbox workAircraft" id="fpd" >
			<label><input class="aircraftSelect" id="expanded" type="checkbox" /> FPD</label>
		</div>
		<div class="checkbox workAircraft" id="fpe" >
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPE</label>
		</div>
		<div class="checkbox workAircraft"  id="fpf" >
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPF</label>
		</div>
		<div class="checkbox workAircraft"  id="fpg" >
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPG</label>
		</div>
		<div class="checkbox workAircraft" id="fph">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPH</label>
		</div>
		<div class="checkbox workAircraft" id="fpi">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPI</label>
		</div>
		<div class="checkbox workAircraft" id="fpj">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPJ</label>
		</div>
		<div class="checkbox workAircraft" id="fpk">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPK</label>
		</div>
		<div class="checkbox workAircraft" id="fpm">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPM</label>
		</div>
		<div class="checkbox workAircraft"id="fpn">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPN</label>
		</div>
		<div class="checkbox workAircraft"id="fpo">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPO</label>
		</div>
		<div class="checkbox workAircraft"id="fpp">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPP</label>
		</div>
		<div class="checkbox workAircraft"id="fpr">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPR</label>
		</div>
		<div class="checkbox workAircraft"id="fps">
			<label><input class="aircraftSelect" id="expanded"  type="checkbox"/> FPS</label>
		</div>
		<div class="checkbox workAircraft"id="fpt">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPT</label>
		</div>
		<div class="checkbox workAircraft"id="fpu">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPU</label>
		</div>
		<div class="checkbox workAircraft"id="fpv">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPV</label>
		</div>
		<div class="checkbox workAircraft"id="fpw">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPW</label>
		</div>
		<div class="checkbox workAircraft"id="fpx">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> FPX</label>
		</div>
		<div class="checkbox workAircraft"id="gea">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> GEA</label>
		</div>
		<div class="checkbox workAircraft"id="geb">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> GEB</label>
		</div>
		<div class="checkbox workAircraft"id="gec">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> GEC</label>
		</div>
		<div class="checkbox workAircraft"id="ged">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> GED</label>
		</div>
		<div class="checkbox workAircraft"id="gef">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> GEF</label>
		</div>
		<div class="checkbox workAircraft"id="geg">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> GEG</label>
		</div>
		<div class="checkbox workAircraft"id="geh">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> GEH</label>
		</div>
	
	</div>
	</div>
	&nbsp;
	
	<div class="card border border-primary shadow">
	<div class="card-header alert alert-primary">Work Performed on Nordica and Other Fleet</div>
	<div class="card-body">
		<div class="checkbox workAircraft " id="acb">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"  /> ACB</label>
		</div>
		<div class="checkbox workAircraft" id="acc">
			<label><input class="aircraftSelect" id="expanded" type="checkbox" /> ACC</label>
		</div>
		<div class="checkbox workAircraft" id="acd">
			<label><input class="aircraftSelect" id="expanded" type="checkbox" /> ACD</label>
		</div>
		<div class="checkbox workAircraft" id="ace" >
			<label><input class="aircraftSelect" id="expanded" type="checkbox" /> ACE</label>
		</div>
		<div class="checkbox workAircraft" id="acf" >
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> ACF</label>
		</div>
		<div class="checkbox workAircraft"  id="acg" >
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> ACG</label>
		</div>
		<div class="checkbox workAircraft"  id="ach" >
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> ACH</label>
		</div>
		<div class="checkbox workAircraft" id="aci">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> ACI</label>
		</div>
		<div class="checkbox workAircraft" id="acj">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> ACJ</label>
		</div>
		<div class="checkbox workAircraft"id="ack">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> ACK</label>
		</div>
		<div class="checkbox workAircraft" id="acl">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> ACL</label>
		</div>
		<div class="checkbox workAircraft" id="acm">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> ACM</label>
		</div>
		<div class="checkbox workAircraft"id="other">
			<label><input class="aircraftSelect" id="expanded" type="checkbox"/> OTHER</label>
		</div>
	</div>
	</div>
	&nbsp;

	<div class="card">
	
	<div class="card-header alert alert-primary">Van Inventory Count Performed By <div class="autocomplete" ><input style="width:100%; margin:2px" type="text" id="n_staff_inv" class="form-control" name="staff_name_inv" required="" placeholder="Staff Name"></div></div>
			<div class="workAircraftExpand" id="findings">
			<table class="table" id="findings_table">
			<thead>
				<tr>
				 <th style="width:2%"></th>
				<th style="width: 80%;"></th>
				<th style="widh:1%"></th><th style="width:2%;"></th>
				</tr>
			</thead>
				<tbody>
				
				<tr id="addButton">
					<td><button type="button" class="btn btn-link add_Row" style="transform: scale(2);" onclick="false"><i class="fas fa-plus-circle"></i></button></td>
				</tr>
				</tbody>
			</table>
			</div>
	
			
	</div>
	&nbsp;
	<div class="card">
	
	<div class="card-header alert alert-primary">Logistics Comment</div>
			<div class="workAircraftExpand" id="logistics">
			<table class="table" id="logistics_table">
			<thead>
				<tr>
				 <th style="width:2%"></th>
				<th style="width: 80%;"></th>
				<th style="widh:1%"></th><th style="width:2%;"></th>
				</tr>
			</thead>
				<tbody>
				
				<tr id="addButton">
					<td><button type="button" class="btn btn-link add_Row" style="transform: scale(2);" onclick="false"><i class="fas fa-plus-circle"></i></button></td>
				</tr>
				</tbody>
			</table>
			</div>
	
			
	</div>
	&nbsp;
	<div class="card">
	<div class="card-header alert alert-primary">Other Comment</div>
			<div class="workAircraftExpand" id="comments">
			<table class="table" id="comments_table">
			<thead>
				<tr>
				 <th style="width:2%"></th>
				<th style="width: 80%;"></th>
				<th style="widh:1%"></th><th style="width:2%;"></th>
				</tr>
			</thead>			
				<tbody>

				<tr id="addButton">
					
					<td><button type="button"  class="btn btn-link add_Row" style="transform: scale(2);" onclick="false"><i class="fas fa-plus-circle"></i></button></td>
				</tr>
				</tbody>
			</table>
			</div>
	
			
	</div>
	
	<br>
   <button class="btn btn-primary newhandoverSubmit">Submit</button>
	
  </div>
  <div class="viewhandover" style="display:none;">
  
  <div class="viewhandoverform" style="margin-bottom:1rem;">
  <div class="d-none" id="handover_id"></div>
  
<table style ="width:100%; border-collapse: separate; margin-bottom:1rem;">
<tbody class="shift_info">
<tr>
<td class="alert alert-primary" >
Shift
</td>
<td class="alert alert-primary">
Shift Start </td>
<td class="alert alert-primary">
Shift End
</td>
</tr>
<tr >
<td class ="border border-primary shadow p-3 bg-white rounded" id="shift" ></td>
<td class ="border border-primary shadow p-3 bg-white rounded" id="starttime" ></td>
<td class ="border border-primary shadow p-3 bg-white rounded" id="endtime"></td>
</tr>
<tr style="display:block; height:5px">
</tr>
<tr style="width:100%">
<td class="alert alert-primary" colspan="3">
Staff</td>
</tr>

</tbody>
</table>
	<div class="alert alert-primary">Work Performed </div>
	<div class="workperformed border border-primary shadow p-3 bg-white rounded"></div>

&nbsp;

		
	<div class="alert alert-primary">Van Inventory Performed by  <div id="Inv_user" style="display:inline"> User Name</div></div>
		<div class="findings_comment border border-primary shadow p-3  bg-white rounded">
		<table class="table table-bordered" id="handover_findings">
		<thead class="thead-light">
	</thead>
			<tbody>
			</tbody>
		</table>
	</div>
 &nbsp;
		
	<div class="alert alert-primary">Logistics Comments </div>
		<div class="logistic_comment border border-primary shadow p-3  bg-white rounded">
		<table class="table table-bordered" id="handover_logistics" >
		<thead class="thead-light">
	</thead>
			<tbody>
			</tbody>
		</table>
	</div>
 &nbsp;
 
	<div class="alert alert-primary">Other Comments </div>
	<div class="other_comments border border-primary shadow p-3 bg-white rounded">
		<table class="table table-bordered" id="handover_comments">
			<tbody>
			</tbody>
		</table>
  
	</div>
  </div> 
   &nbsp;
  
 </div>
 </div>
 </div>

 <div>
  <div class="preview" style="display:none;">
	</div>
 
 <div id="myModal" class="successAlert" role="dialog" style="display:none;">
  <div class="modal-dialog" style="margin: 10rem auto;">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title text-success">Handover Saved !!</h4>
      </div>
      <div class="modal-body" style="text-align:left;">
        <p id="emailConfirm">Email is  sent automatically to Handover mailing group.<br /><br /></p><p><b><span class="text-primary"> Please remember, If tasks cencerns to other station notify concerned stations via Phone and email</span><br /><br /></b> Minimal version of Handover will be generated on next page for Printing and archiving purpose.<br /><br />Please send any feedback to <a href="mailto:lmcityjetplannerhel@samco.aero">lmcityjetplannerhel@samco.aero</a> </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="closeAlert" class="btn btn-default">Close</button>
      </div>
    </div>

  </div>
</div>
<div id ="testmodel" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content handoverViewer" style="padding:15px">
	
    </div>
  </div>
</div>
</div>

		
 
</body>

<script type="text/javascript">
$(document).ready(function() {
	
	var test = true;
	var sendTo = 'https://script.google.com/macros/s/AKfycbwqAAovEZSfE9XBCPqICS_UP20rPgLdKs9IZbFNzO-hAph__HgX/exec';
	var ua = window.navigator.userAgent;
	var station = "";
	var browser = "";
	var handoverId ="";
	var activeStaff="";
	
	var inst_Link = "https://drive.google.com/file/d/1IMWf2oeJDSonQpv0z0DiYO_tII6zoMYE/preview"
	if(!(/chrom(e|ium)/.test( window.navigator.userAgent.toLowerCase()))){
		alert("Please use this program with Google Chrome Browser. Support for other browser has been discontinued, sorry for inconvenience ");
		$('.container').hide();
		return;
	}
	
	checkCurrentVersion();
	
	$(document).on("click", "#chooseStation", function() {
		
		if(station){
			
			loadHandoverPage(station);
				
		}else{
			$('.chooseStation').effect( "bounce", "slow" );
			$('.chooseStation').children(':first').addClass('error');
		}
		
		if($("#remember").is(':checked')){
			localStorage.setItem("station",station);
			
		}
		
		
		
	

    });
	
	


	
	$(document).on("click", "input[name=radioButtonStation]", function() {
		$('.chooseStation').children(':first').removeClass('error')
		station=$(this).val();

    });
	
	function loadHandoverPage(station){
	
		$(".chooseStation").hide();
		$('.loader').show();
	    $.getJSON(sendTo + "?callback=?", {
            method: "getHandover",
            station: station,
        },
        function(data) {
			if(activeStaff =="" ){
				$.getJSON(sendTo + "?callback=?", {
				method: "getStaffList",
				},				
					function(data) {
						activeStaff = data
						$('input[name*="staff_name"]').each(function(i, obj) {
						autocomplete("#"+$(obj).attr("id"),activeStaff);
						});
						autocomplete("#search_name",activeStaff);
					});
			}
			
			$('#station').html(stationAbbr(station, false)+" <a class=\"resetStation\" href=\"#\" style=\"font-weight:normal\"></a>");
			
			handoverId = data['Id'];
			var savedData = checkSavedData(station);
			$('.loader').hide();
			
			if(savedData != ""){

				$( ".NewHandoverBtn" ).trigger( "click" );
				
				$('.newhandover').empty();
				$('.newhandover').append(savedData['htmldata']);

				for (var id in savedData['values'])
				{
					 $("#"+id).val(savedData['values'][id]);
				
				}
				$('.viewhandover').empty();
				$('.viewhandover').append(savedData['LastHandover']);
				
				
				var alert = "<div class=\"alert customAlert alert-warning alert-dismissible fade show\" role=\"alert\"><strong>Loaded from Saved Data!</strong><br> Note that this is loaded from previously saved data. Click Reset to create new.<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>"
				
				$(alert).insertAfter($('.menubar'));
				$('.ResetHandoverBtn').show()
				$('.alert').alert()
				
					$(".popovernote").popover({
					container: '.content',
					html: true
				});
				
		
				$('div[id^="datetimepicker"]').each(function(i, obj) {
					formatDateTimePicker($(obj).attr("id"));
				});
				
				$('div[id^="datetimepicker"]').each(function(i, obj) {
					formatDateTimePicker($(obj).attr("id"));
				});
				
				$('input[name*="staff_name"]').each(function(i, obj) {
					autocomplete("#"+$(obj).attr("id"),activeStaff);
				});
				actionDropDowns();
				
				return
			}
			
			else{
				$(".viewhandover").show(); 
				$(".menubar").show();$('.NewHandoverBtn').show();
            }
			var lastHandover = data;
			$('html,body').animate({
            scrollTop: 0
        }, 700);


            //$("#handover_id").html(lastHandover['rowNumber']);

           
  
            var staff = lastHandover['Staff'];
			
            for (k in staff) {
				var st =staff[k]['starttime'] ||""
				var et = staff[k]['endtime'] ||""
                $('.shift_info').append('<tr><td class ="border border-primary shadow  bg-white rounded" style="    padding: 0.5rem 1rem 0.5rem 0.5rem;">'+staff[k]['name']+'</td><td style="    padding: 0.5rem 1rem 0.5rem 0.5rem;"class ="border border-primary shadow  bg-white rounded" >'+st+'</td><td style="    padding: 0.5rem 1rem 0.5rem 0.5rem;" class ="border border-primary shadow  bg-white rounded" >'+et+'</td></tr>');
            }

            $('#starttime').html(lastHandover['Start Time']); 
			$('#endtime').html(lastHandover['End Time']);
			$('#shift').html(lastHandover['shift']);
			$('#Inv_user').html(lastHandover['Inventory Performed By'])
            for (aircraftName in lastHandover['Work Performed On']) {
				
                var aircraftTable = "<div class=\"workAircraftExpand\" ><table class=\"table table-bordered\" style=\"margin-bottom:1rem;\"id=\"handover_" + aircraftName + "\"><thead class=\"thead-light\"><tr><th style=\"width:5%;\"><\/th><th class=\"text-center\" style=\"width:95%;\"><strong>" + aircraftName.toUpperCase() + "</strong><\/th><\/tr><\/thead><tbody> <\/tbody><\/table><\/div>";
                $('.workperformed').append(aircraftTable);

                var taskDetail = (lastHandover['Work Performed On'][aircraftName]);
                for (taskIndex in taskDetail) {
                    var taskRow = "<tr><td style=\"width:5%;\">" + (parseInt(taskIndex) + 1) + "<\/td><td id='td_" + aircraftName.toLowerCase() +"_" +(parseInt(taskIndex) + 1) + "' style=\"width:95%;\"><\/td><\/tr>"
                    $("#handover_" + aircraftName + " tbody").append(taskRow);

                    var task = taskDetail[taskIndex];
                    var note = "";
					
					var actionLabel ="<span class=\"badge badge-danger\">Action  Required </span><br>";

                    //Check If the task is completed, deferred or requires action 
                    if (RegExp("Completed").test(task[1])) {

                        note = "<span class=\"badge badge-primary\">Action from last last Shift:"+ "   "  +" </span><span class=\"badge badge-success action_badge\"> " + task[1] + "<\/span><span id=\"btn_view_note_" + aircraftName + "_task_" + (parseInt(taskIndex) + 1) + "\"></span><br>";
						actionLabel ="";
						
                    } else if (RegExp("Deferred").test(task[1])) {
                        note = "<span class=\"badge badge-primary\">Action from last last Shift:"+ "   "  +" </span><span class=\"badge badge-warning action_badge\">" + task[1] + "<\/span><span id=\"btn_view_note_" + aircraftName + "_task_" +(parseInt(taskIndex) + 1) + "\"></span><br>";                         

                    }else if (RegExp("No action Required").test(task[1])) {
                        note = "<span class=\"badge badge-primary\">Action from last last Shift:"+ "   "  +" </span><span class=\"badge badge-warning action_badge\">" + task[1] + "<\/span><span id=\"btn_view_note_" + aircraftName + "_task_" + (parseInt(taskIndex) + 1) + "\"></span><br>";   
						actionLabel ="";
						dropDownMenu ="";

                    }else if(!RegExp("Action Required").test(task[1])){
						actionLabel ="";
						dropDownMenu ="";
					}
					
                    $("#td_" + aircraftName.toLowerCase()+"_" +(parseInt(taskIndex) + 1)).append(note);

                    // check if there is  note to task if true add popover note
					var notebutton="";
                    if (!(typeof task[2] == "undefined") && task[2].trim() !="") {

                        notebutton = "<button type=\"button\"	 onclick=\"false\" class=\"btn btn-link popovernote\" data-toggle=\"popover\" data-placement= \"bottom\" title=\"Action History:\" data-trigger=\"focus\" data-content=\"" + task[2] + "\"><i class=\"fa fa-comment\"><\/i><\/button>";
                        $("#btn_view_note_" + aircraftName + "_task_" + (parseInt(taskIndex) + 1)).append(notebutton);
                        $(".popovernote").popover({
                            container: '.content',
                            html: true
                        });
                    }

                    //check if the task requires action or not	

                    $("#td_" + aircraftName.toLowerCase() +"_"+ (parseInt(taskIndex) + 1)).append(actionLabel + task[0]);
					
					if(RegExp("Action Required").test(task[1]) || RegExp("Deferred").test(task[1])){
					
						if(notebutton){
							notebutton  = "<button class=\"btn btn-link popovernote\" data-toggle=\"popover\" data-placement= \"bottom\" title=\"Action History\" data-trigger=\"focus\"  data-content=\"<b>"+$('#td_'+aircraftName+"_"+(parseInt(taskIndex) + 1) +' .action_badge').text()+"</b><br>" + task[2] + "\"><i class=\"fa fa-comment\"><\/i><\/button>";
						}
						
						/*<button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-primary btn-xs action\"style=\"width:100%\">Completed at Another Station<\/button>\n					<button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-danger btn-xs action\"style=\"width:100%\">Deferred to Another Station<\/button>\n					*/
						
						var dropDownMenu = "<div class=\"clearfix actionrequired\"><div class=\"td_action\"><div class=\"dropdown float-left\"><button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-danger btn-xs dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">Action Required <\/button><div class=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton\">\n					<button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-success btn-xs action\" style=\"width:100%\">Completed<\/button>\n					<button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-warning btn-xs action\"style=\"width:100%\">Deferred to next shift<\/button>\n<button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-primary btn-xs action\"style=\"width:100%\">No action Required<\/button><\/div>\n <\/div><input type=\"hidden\" id=\"action_select\" name=\"" + aircraftName + "_task_" + (parseInt(taskIndex) + 1) + "_action\" required ><\/div> <div class=\"float-left actionUser\"><\/div><div class=\"float-left additionalNote\"><\/div>"+notebutton+"<\/div>"
						
						checkedAircraft(aircraftName.toLowerCase(), true);
						
						var rowNum = $('#'+ aircraftName.toLowerCase()+"_table tbody tr").length;
						var row = "<tr style=\"background-color:#5a7c030f;\"><td>"+rowNum+"</td><td id=\"actionfromLastHandover_"+ aircraftName.toLowerCase()+"_"+(parseInt(taskIndex) + 1)+"\">"+dropDownMenu + task[0]+"<\/td><td></td><td></td><\/tr>"
						$(row).insertBefore($("#" + aircraftName.toLowerCase() + " #addButton"));
					}
                }
            }
			
			if(!lastHandover.hasOwnProperty('Inventory Findings')){
				$('.findings_comment').html("No Findings")
			
			}else{
				for (comment in lastHandover['Inventory Findings']) {
                var task = lastHandover['Inventory Findings'][comment];
                var taskRow = "<tr><td style=\"width:5%;\">" + (parseInt(comment) + 1) + "<\/td><td id='td_findings_" + (parseInt(comment) + 1)+ "' style=\"width:95%;\"><\/td><\/tr>"
                $("#handover_findings tbody").append(taskRow);
                var note = "";
                
                
				var actionLabel ="<span class=\"badge badge-danger\">Action  Required </span><br>";

                    //check if the task is new or deferred
					if (RegExp("Completed").test(task[1])) {
						note = "<span class=\"badge badge-primary\"><strong>Action from last last Shift:<\/strong>"+ "   "  +" </span><span class=\"badge badge-success action_badge\">" + task[1] + "<\/span><span id=\"btn_view_note_findings_task_" + (parseInt(comment) + 1) + "\"></span><br>";					
						actionLabel ="";
						
					} 
					else if (RegExp("Deferred").test(task[1])) {
						note ="<span class=\"badge badge-primary\"><strong>Action from last last Shift:<\/strong>"+ "   "  +" </span><span class=\"badge badge-warning action_badge\">" + task[1] + "<\/span><span id=\"btn_view_note_findings_task_" + (parseInt(comment) + 1)+ "\"></span><br>";
                        if (!RegExp("Deferred to next").test(task[1]) && !RegExp("Deferred action from").test(task[1])){
						actionLabel ="";
						
						}
					}
					else if(!RegExp("Action Required").test(task[1])){
						actionLabel ="";
					}
				
				
					$("#td_findings_" + (parseInt(comment) + 1)).append(note);    
					$("#td_findings_" + (parseInt(comment) + 1)).append(actionLabel + task[0]);
                     
					 // check if there is deferred note to task if true add popover note
					 var notebutton="";

                    if (!(typeof task[2] === 'undefined') && task[2].trim() !="") {
                            var notebutton = "<button class=\"btn btn-link popovernote\" data-toggle=\"popover\" data-placement= \"bottom\" title=\"Action History\" data-trigger=\"focus\"  data-content=\"" + task[2] + "\"><i class=\"fa fa-comment\"><\/i><\/button>";
                            $("#btn_view_note_findings_task_" + (parseInt(comment) + 1)).append(notebutton);
                            $(".popovernote").popover({
                                container: 'body',
                                html: true
                            });
                        }
					
					if(RegExp("Action Required").test(task[1]) || RegExp("Deferred").test(task[1])){
						
						if(notebutton){
							notebutton  = "<button class=\"btn btn-link popovernote\" data-toggle=\"popover\" data-placement= \"bottom\" title=\"Action History\" data-trigger=\"focus\"  data-content=\"<b>"+$('#td_findings_'+(parseInt(comment) + 1)+' '+'.action_badge').text()+"</b><br>" + task[2] + "\"><i class=\"fa fa-comment\"><\/i><\/button>";
						}
						
						var dropDownMenu = "<div class=\"clearfix actionrequired\"><div class=\"td_action\"><div class=\"dropdown float-left\"><button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-danger btn-xs dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">Action Required <\/button><div class=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton\">\n					<button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-success btn-xs action\" style=\"width:100%\">Completed<\/button>\n					<button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-warning btn-xs action\"style=\"width:100%\">Deferred to next shift<\/button>\n<button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-primary btn-xs action\"style=\"width:100%\">No action Required<\/button>	<\/div>\n <\/div><input type=\"hidden\" id=\"action_select\" name=\"findings_task_" + (parseInt(comment) + 1) + "_action\" required ><\/div> <div class=\"float-left actionUser\"><\/div><div class=\"float-left additionalNote\"><\/div>"+notebutton+"<\/div>"
						
						var rowNum = $("#findings_table tbody tr").length;
						var row = "<tr  style=\"background-color:#5a7c030f;\"><td>"+rowNum+"</td><td id=\"actionfromLastHandover_findings_"+(parseInt(comment) + 1)+"\">"+dropDownMenu + task[0]+"<\/td><td></td><td></td><\/tr>"
						 $(row).insertBefore($("#findings_table #addButton"));
					}                

            }
			
			
			
			}

            for (comment in lastHandover['Logistics Comments']) {
                var task = lastHandover['Logistics Comments'][comment];
                var taskRow = "<tr><td style=\"width:5%;\">" + (parseInt(comment) + 1) + "<\/td><td id='td_logistics_" + (parseInt(comment) + 1)+ "' style=\"width:95%;\"><\/td><\/tr>"
                $("#handover_logistics tbody").append(taskRow);
                var note = "";
                
                
				var actionLabel ="<span class=\"badge badge-danger\">Action  Required </span><br>";

                    //check if the task is new or deferred
					if (RegExp("Completed").test(task[1])) {
						note = "<span class=\"badge badge-primary\"><strong>Action from last last Shift:<\/strong>"+ "   "  +" </span><span class=\"badge badge-success action_badge\">" + task[1] + "<\/span><span id=\"btn_view_note_logistics_task_" + (parseInt(comment) + 1) + "\"></span><br>";					
						actionLabel ="";
						
					} 
					else if (RegExp("Deferred").test(task[1])) {
						note ="<span class=\"badge badge-primary\"><strong>Action from last last Shift:<\/strong>"+ "   "  +" </span><span class=\"badge badge-warning action_badge\">" + task[1] + "<\/span><span id=\"btn_view_note_logistics_task_" + (parseInt(comment) + 1)+ "\"></span><br>";
                        if (!RegExp("Deferred to next").test(task[1]) && !RegExp("Deferred action from").test(task[1])){
						actionLabel ="";
						
						}
					}
					else if(!RegExp("Action Required").test(task[1])){
						actionLabel ="";
					}
				
				
					$("#td_logistics_" + (parseInt(comment) + 1)).append(note);    
					$("#td_logistics_" + (parseInt(comment) + 1)).append(actionLabel + task[0]);
                     
					 // check if there is deferred note to task if true add popover note
					 var notebutton="";

                    if (!(typeof task[2] === 'undefined') && task[2].trim() !="") {
                            var notebutton = "<button class=\"btn btn-link popovernote\" data-toggle=\"popover\" data-placement= \"bottom\" title=\"Action History\" data-trigger=\"focus\"  data-content=\"" + task[2] + "\"><i class=\"fa fa-comment\"><\/i><\/button>";
                            $("#btn_view_note_logistics_task_" + (parseInt(comment) + 1)).append(notebutton);
                            $(".popovernote").popover({
                                container: 'body',
                                html: true
                            });
                        }
					
					if(RegExp("Action Required").test(task[1]) || RegExp("Deferred").test(task[1])){
						
						if(notebutton){
							notebutton  = "<button class=\"btn btn-link popovernote\" data-toggle=\"popover\" data-placement= \"bottom\" title=\"Action History\" data-trigger=\"focus\"  data-content=\"<b>"+$('#td_logistics_'+(parseInt(comment) + 1)+' '+'.action_badge').text()+"</b><br>" + task[2] + "\"><i class=\"fa fa-comment\"><\/i><\/button>";
						}
						
						var dropDownMenu = "<div class=\"clearfix actionrequired\"><div class=\"td_action\"><div class=\"dropdown float-left\"><button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-danger btn-xs dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">Action Required <\/button><div class=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton\">\n					<button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-success btn-xs action\" style=\"width:100%\">Completed<\/button>\n					<button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-warning btn-xs action\"style=\"width:100%\">Deferred to next shift<\/button>\n<button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-primary btn-xs action\"style=\"width:100%\">No action Required<\/button>	<\/div>\n <\/div><input type=\"hidden\" id=\"action_select\" name=\"logistics_task_" + (parseInt(comment) + 1) + "_action\" required ><\/div> <div class=\"float-left actionUser\"><\/div><div class=\"float-left additionalNote\"><\/div>"+notebutton+"<\/div>"
						
						var rowNum = $("#logistics_table tbody tr").length;
						var row = "<tr  style=\"background-color:#5a7c030f;\"><td>"+rowNum+"</td><td id=\"actionfromLastHandover_logistics_"+(parseInt(comment) + 1)+"\">"+dropDownMenu+ task[0]+"<\/td><td></td><td></td><\/tr>"
						 $(row).insertBefore($("#logistics_table #addButton"));
					}                

            }

			for (comment in lastHandover['Other Comments']) {
                var task = lastHandover['Other Comments'][comment];
                var taskRow = "<tr><td style=\"width:5%;\">" + (parseInt(comment) + 1) + "<\/td><td id='td_comments_" + (parseInt(comment) + 1)+ "' style=\"width:95%;\"><\/td><\/tr>"
				
                $("#handover_comments tbody").append(taskRow);
                var note = "";
                
				var actionLabel ="<span class=\"badge badge-danger\">Action  Required </span><br>";

                    //check if the task is new or deferred
					if (RegExp("Completed").test(task[1])) {
                        note = "<span class=\"badge badge-primary\"><strong>Action from last Shift:<\/strong>"+ "   "  +" </span><span class=\"badge badge-success action_badge\">" + task[1] + "<\/span><span id=\"btn_view_note_comments_task_" + (parseInt(comment) + 1) + "\"></span><br>";
						actionLabel ="";
						
					} 
					else if (RegExp("Deferred").test(task[1])) {
                         note = "<span class=\"badge badge-primary\"><strong>Action from last Shift:<\/strong>"+ "   "  +" </span><span class=\"badge badge-warning action_badge\">" + task[1] + "<\/span><span id=\"btn_view_note_comments_task_" + (parseInt(comment) + 1) + "\"></span><br>";
						 
                        if (!RegExp("Deferred to next").test(task[1]) && !RegExp("Deferred action from").test(task[1])){
						actionLabel ="";
						}
						
					}else if(!RegExp("Action Required").test(task[1])){
						actionLabel ="";
					}
					$("#td_comments_" + (parseInt(comment) + 1)).append(note); 
					$("#td_comments_" + (parseInt(comment) + 1)).append(actionLabel + task[0]);
                        
						// check if there is deferred note to task if true add popover note
						var notebutton="";

                    if (!(typeof task[2] === 'undefined') && task[2].trim() !="") {
                            var notebutton = "<button class=\"btn btn-link popovernote\" data-toggle=\"popover\" data-placement= \"bottom\" title=\"Action History\" data-trigger=\"focus\"  data-content=\"" + task[2] + "\"><i class=\"fa fa-comment\"><\/i><\/button>";
                            
							$("#btn_view_note_comments_task_" + (parseInt(comment) + 1)).append(notebutton);
                        }
						
					if(RegExp("Action Required").test(task[1]) || RegExp("Deferred").test(task[1])){
						if(notebutton){
							notebutton  = "<button class=\"btn btn-link popovernote\" data-toggle=\"popover\" data-placement= \"bottom\" title=\"Action History\" data-trigger=\"focus\"  data-content=\"<b>"+$('#td_comments_'+(parseInt(comment) + 1)+' '+'.action_badge').text()+"</b><br>" + task[2] + "\"><i class=\"fa fa-comment\"><\/i><\/button>";
						}
						
						var dropDownMenu = "<div class=\"clearfix actionrequired\"><div class=\"td_action\"><div class=\"dropdown float-left\"><button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-danger btn-xs dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">Action Required <\/button><div class=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton\">\n					<button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-success btn-xs action\" style=\"width:100%\">Completed<\/button>\n					<button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-warning btn-xs action\"style=\"width:100%\">Deferred to next shift<\/button>\n<button type=\"button\"	 onclick=\"false\" class=\"btn btn-outline-primary btn-xs action\"style=\"width:100%\">No action Required<\/button>					<\/div>\n <\/div><input type=\"hidden\" id=\"action_select\" name=\"comments_task_" + (parseInt(comment) + 1) + "_action\" required ><\/div> <div class=\"float-left actionUser\"><\/div><div class=\"float-left additionalNote\"><\/div>"+notebutton+"<\/div>"
						
						var rowNum = $("#comments_table tbody tr").length;
						var row = "<tr  style=\"background-color:#5a7c030f;\"><td>"+rowNum+"</td><td id=\"actionfromLastHandover_comments_"+(parseInt(comment) + 1)+"\">"+dropDownMenu+ task[0]+"<\/td><td></td><td></td><\/tr>"
						$(row).insertBefore($("#comments_table #addButton"));
					}	

            }
			$(".popovernote").popover({
					container: '.content',
					html: true
				});
			
			
			var page=$('.newhandover').html()
			localStorage.setItem('resetPage',page);			
        });
		
	}
	
	$('#datetimepicker1').datetimepicker({
        format: 'DD-MMM HH:mm',
		sideBySide:true,
		defaultDate:"",
    });
	 
	
	formatDateTimePicker('datetimepicker1');
	formatDateTimePicker('datetimepicker_e_1');
	formatDateTimePicker('datetimepicker_s_1');
	
  

    $(document).on("click", ".btn_addnote", function() {
		if( $(".popover").length != 0){
			return;
		}

		var taskId = ($(this).closest('td').attr('id')).substring(23, $(this).closest('td').attr('id').length);
		
		var popovernote = $(this).closest('td').find('.popovernote');
		
		$(this).html("Save Note");
		
		if (popovernote.length != 0){
			popovernote.popover("show");
			
			var noteinput = $("#"+taskId+"_noteId")

			if(noteinput.length == 0){	
				noteinput = "<div class=\"noteinput\"><textarea class=\"form-control task_note\"  style =\"resize: vertical;\"  name=\"task_note\" id=\""+taskId+"_noteId\" ><\/textarea><\/div>";
					popovernote.attr('data-content',noteinput+popovernote.attr('data-content'));
					popovernote.popover("show");
				}
				
	
		}else{

			noteinput='<div class=\'noteinput\'><textarea class=\'form-control task_note\'  style =\'resize: vertical;\' name=\'task_note\' id=\''+taskId+'_noteId\'><\/textarea><\/div>'
			
			notebutton  = "<button class=\"btn btn-link popovernote\" data-toggle=\"popover\"  title=\"Action History\" data-trigger=\"focus\"  data-content=\""+ noteinput+ "\"><i class=\"fa fa-comment\"><\/i><\/button>";
			
			$(this).closest(".actionrequired").append(notebutton);
			$(".popovernote").popover({
                                container: '.content',
                                html: true
            });
			
			popovernote = $(this).closest('td').find('.popovernote');
			popovernote.popover("show");
			

		}
			var scroll = $(window).scrollTop()
			$("#"+taskId+"_noteId").focus();
			window.scrollTo(0,scroll);		
    });
	
	$(document).on( "blur",".task_note",function(){
		var note =  $(this).val()
		//console.log($(this).attr("id"));
		var id = $(this).attr("id").substring(0, ($(this).attr('id').length-7))
		var targetId = "actionfromLastHandover_"+id;
		var popovernote = $("#"+targetId).find(".popovernote")
		var addButton = $("#"+targetId).find(".btn_addnote")
		
		if(note ==""){
			popovernote.attr('data-content', (popovernote.attr('data-content')).replace(/<div(.|\n|\r)+div>/g,""));
			addButton.html("Add Note");
		}
		else{
			noteinput='<div class=\'noteinput\'><textarea class=\'form-control task_note\'  style =\'resize: vertical;\' name=\'task_note\' id=\''+$(this).attr("id")+'\'>'+note+'<\/textarea><\/div>'
			popovernote.attr('data-content', (popovernote.attr('data-content')).replace(/<div(.|\n|\r)+div>/g,noteinput));
			addButton.html("Edit Note");
		}
		
		 popovernote.popover("hide");

		if(popovernote.attr('data-content')+note==""){	
			popovernote.remove();
			addButton.html("Add Note");
		}
	
	} )
	actionDropDowns();
	
function actionDropDowns(){
	$(document).on("click", ".dropdown-menu button,.dropdown-item", function() {
	

                var dropdown_button = $(this).closest('.dropdown').children(":first");
                dropdown_button.text($(this).text())
				
				if( $(this).closest('.dropdown').attr("id")=="month"){
					return
				}

                var dropdownValueField = $(this).closest('.dropdown').nextAll('input[type="hidden"]:first')
                var id = ($(this).closest('td').attr('id')).substring(23, $(this).closest('td').attr('id').length);

                dropdownValueField.val($(this).text());

                $(this).closest('.td_action').nextAll(".dueToChooser").remove();

                var dueToChooser = $("<div class=\"dueToChooser float-left\"><div class=\"dropdown\" style =\"display: inline-block !important;\">\n  <button class=\"btn btn-outline-danger btn-xs dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">Select Reason<\/button>\n  <div class=\"dropdown-menu\" aria-labelledby=\"dropdownMenuButton\">\n    <a class=\"dropdown-item\" id=\"arn\">Aircraft No Show <\/a>\n    <a class=\"dropdown-item\" id=\"cph\">Task no longer applicable<\/a>\n <\/div>\n<\/div><input id=\"action_select_reason\" type=\"hidden\" name=\"" + id + "_station\" required ><\/div>");
				
				 dropdown_button.removeClass(" btn-outline-danger").addClass('btn-outline-success');
				 
                switch ($(this).text()) {
                    case "Completed":
                    case "Deferred to next shift":

                        //////console.log($(this).closest('.td_action'));
                        $(this).closest('.td_action').nextAll(".actionUser:first").empty().append("<div class=\"autocomplete\"><input type=\"text\" id=\"staff_name_"+id+"\"  class=\"form-control\" name=\"action_staff_name_" + id + "\" placeholder=\"Performed by \"></div>").children().focus();

                        $(this).closest('.td_action').nextAll(".additionalNote:first").empty().append("<i class=\"btn btn-xs text-primary fa btn_addnote fa-edit\"> Add Note</i>");
                        //$(this).closest('.dropdown').next();
                        break;

                    case "No action Required":
                        $(this).closest('.td_action').after(dueToChooser);
                        $(this).closest('.td_action').nextAll(".actionUser:first").empty();
                        $(this).closest('.td_action').nextAll(".additionalNote:first").empty().append("<i class=\"btn btn-xs text-primary fa btn_addnote fa-edit\"> Add Note</i>");
                        break;
                }
				
				autocomplete('#staff_name_'+id,activeStaff);
            });

}

	//$('#start_time').val(moment().subtract(9,"hours").format('DD/MM/YYYY HH:mm'));

	$(document).on("click", ".toNextShift", function() {
		$(this).closest('div').parent().find('input').first().val("Continued to Next Shift")	
	})
	$(document).on("click", ".fromLastShift", function() {
		$(this).closest('div').parent().find('input').first().val("Continued from Last Shift")	
	})
	
	
    $(document).on("click", "input[type=checkbox]", function() {
        if (this.checked) {
            $(this).val("true");
			$(this).attr("checked","checked")
        } else {
            $(this).val("false");
        }
    });



    $(document).on("click", ".aircraftSelect", function() {
        if (this.checked) {
            var aircraftName = ($(this).closest('label').text().toLowerCase()).trim();
            checkedAircraft(aircraftName, false);


        } else {
            var aircraftName = ($(this).parent().next('th').text().toLowerCase());
            uncheckAircraft(aircraftName);

        }

    });

    //Function to make aircraft div expand on select, disable=true will disable the checkbox & table will be created without row
    function checkedAircraft(aircraftName, disable) {
		 var disable = disable || false;
        var aircraftName = aircraftName.toLowerCase();



        if (!$("div#" + aircraftName).hasClass('workAircraftExpand')) {
            $("div#" + aircraftName).addClass('workAircraftExpand').removeClass('workAircraft');
            var htmldata = "<table class=\"table\" id=\"" + aircraftName + "_table\">\n <thead class=\"thead-light\">\n	<tr >\n <th style=\"width:2%\"><input class=\"aircraftSelect\" id=\"checkbox_" + aircraftName + "\" type=\"checkbox\" checked=\"checked\" /><\/th>\n<th class=\"text-center\">" + aircraftName.toUpperCase() + "<\/th>\n <th class=\"text-bottom\" style=\"width:4%\"><\/th>\n<th style=\"width:4%\"><\/th>\n <\/tr>\n	<\/thead>\n	<tbody>\n 				<tr id=\"addButton\">\n					<td><button type=\"button\" class=\"btn btn-link add_Row\" style=\"transform: scale(2);\ onclick=\"false\"><i class=\"fa fa-plus-circle\"><\/i><\/button><\/td>\n	<\/tr>\n			<\/tbody>\n		<\/table>"

            $("div#" + aircraftName).children(':first').replaceWith(htmldata);
			var rowCount = parseInt($("#"+ aircraftName + "_table tbody").find('tr').length);
		
        }
        if (disable == true) {
            $("input#checkbox_" + aircraftName).attr("disabled", true);
        } else {
            var tablerow = $("<tr>\n<td>"+rowCount+"<\/td>\n					<td><div class=\"form-group\"><textarea class=\"form-control\"  style =\"resize: vertical;\" id=\"" + aircraftName + "_task_"+rowCount+"\" name=\"" + aircraftName + "_task_"+rowCount+"\" required><\/textarea><\/div><\/td>\n <td class=\"text-center nopadding\" ><span class=\"small\">Action Required.<br><\/span> <input type=\"checkbox\" id=\"" + aircraftName + "_task_"+rowCount+"_check\" name=\"" + aircraftName + "_task_"+rowCount+"_check\"  value =\"false\"\/><\/td>\n<td><button class=\"btn btn-link \"><\/button><\/td>\n<\/tr>\n<\/tr>\n")
            
			tablerow.insertBefore($("#" + aircraftName + " #addButton"));
			
			$("#" + aircraftName + " #addButton").prev().children().find('textarea').focus();
        }


    }

    function uncheckAircraft(aircraftName) {
	
		

        $("div#" + aircraftName).addClass('workAircraft').removeClass('workAircraftExpand');
		
		if(aircraftName.legth ==3 ){
			aircraftNamea=aircraftName.toUpperCase()
		}
		else{
		 aircraftNamea = aircraftName.charAt(0).toUpperCase() + aircraftName.slice(1)
		}
		
        var htmldata = "<label><input class=\"aircraftSelect\" type=\"checkbox\" \/ id=\"expanded\"> " + aircraftNamea + "<\/label>"
        
		$("div#" + aircraftName).children(':first').replaceWith(htmldata);

    }


    $(document).on("click", ".add_Row", function() {
        var table = ($(this).closest('.card').children(":first").text().toLowerCase().trim());
			console.log(table);
        var id;
		var rowCount = parseInt($(this).closest('tbody').find('tr').length);
        switch (table) {
            case "work performed on cityjet fleet":
			case "work performed on nordica and other fleet":
                var aircraftName = ($(this).closest('table').find("th").next().html().toLowerCase().trim());
                id = aircraftName + "_task_"+rowCount;
                break;


            case "logistics comment":
                //////console.log(table);
                id = "logistics_task_"+rowCount;
                break;

            case "other comment":
                id = "comments_task_"+rowCount;
                break;
			
			case "van inventory count performed by":
                id = "findings_task_"+rowCount;
                break;

            case "staff":				
				var row = "<tr><td><div class=\"form-inline autocomplete\"><div class=\"autocomplete float-left\" style=\"width: 39%;\"><input placeholder=\"Staff Name\" type=\"text\" id=\"n_staff_"+rowCount+"\" class=\"form-control\" name=\"n_staff_name_"+rowCount+"\" required=\"\" style=\"width: 100%;\"></div><div class=\"input-group date float-left\" id=\"datetimepicker_s_"+rowCount+"\" data-target-input=\"nearest\" style=\"margin-left: 0.1rem;width: 30%;\"><input placeholder=\"Start Time\" id=\"n_staff_"+rowCount+"_s\"type=\"text\" 	class=\"form-control datetimepicker-input \" data-target=\"#datetimepicker_s_"+rowCount+"\" value=\"\"><div class=\"input-group-append\" data-target=\"#datetimepicker_s_"+rowCount+"\" data-toggle=\"datetimepicker\"><div class=\"input-group-text\"><i class=\"far fa-clock\"><\/i><\/div><\/div><\/div>\r\n<div class=\"input-group date float-left\" id=\"datetimepicker_e_"+rowCount+"\" data-target-input=\"nearest\" style=\"margin-left: 0.1rem;width: 30%;\"><input placeholder=\"End Time\" id=\"n_staff_"+rowCount+"_e\"type=\"text\" class=\"form-control datetimepicker-input\" data-target=\"#datetimepicker_e_"+rowCount+"\" value=\"\"><div class=\"input-group-append\" data-target=\"#datetimepicker_e_"+rowCount+"\" data-toggle=\"datetimepicker\"><div class=\"input-group-text\"><i class=\"far fa-clock\"><\/i><\/div><\/div><\/div>\r\n<\/div><\/td><td style=\"width:6%\"><button type=\"button\" class=\"btn btn-link delete_Row\" style=\"transform: scale(1.5); \" onclick=\"false\"><i class=\"fa fa-trash\"><\/i><\/button><\/td> <\/tr>"
        }

		

        if (table == "staff") {
            htmldata = row;
			$(this).closest('tr').before(htmldata);
			$(this).closest('tr').prev().children().find('input').first().focus();
			formatDateTimePicker('datetimepicker_e_'+rowCount);
			formatDateTimePicker('datetimepicker_s_'+rowCount);
			autocomplete('#n_staff_'+rowCount,activeStaff);
			
			

        } else {
            var htmldata = "<tr >\n<td style=\"width:2%\">" + (rowCount) + "<\/td>\n <td><div class=\"form-group\"><textarea id=\""+id+"\"class=\"form-control\"  style =\"resize: vertical;\" name=\"" + id + "\" required><\/textarea><\/div><\/td>\n <td style=\"width:4%\" class=\"text-center nopadding\" ><span class=\"small\">Action Required.<br><\/span> <input type=\"checkbox\" id=\"" + id + "_check\" name=\"" + id + "_check\" value=\"false\"\/><\/td>\n <td style=\" padding: 25px 0 0 0; vertical-align: top;\"><button type=\"button\" class=\"btn btn-link delete_Row\" style=\"transform: scale(1.5);\" onclick=\"false\"><i class=\"fa fa-trash\"><\/i><\/button><\/td>\n	<\/tr>"
			
			
			
			$(this).closest('tr').before(htmldata);
			$(this).closest('tr').prev().children().find('textarea').focus();
		}
		
        
    });

    $(document).on("click", ".delete_Row", function() {
        $(this).closest('tr').remove();
    });


    function stationAbbr(station) {
		var abbr = abbr || true
        switch (station.toLowerCase()) {

            case "arlanda":
                if (abbr === true) {
                    return "ARN"
                }
            case "arn":
                return "Arlanda";

            case "oslo":
                if (abbr === true) {
                    return "OSL"
                }
            case "osl":
                return "Oslo";

            case "trondheim":
                if (abbr === true) {
                    return "TRD"
                }
            case "trd":
                return "Trondheim";

            case "helsinki":
                if (abbr === true) {
                    return "HEL"
                }

            case "hel":
                return "Helsinki";

            case "tallinn":
                if (abbr === true) {
                    return "TLL"
                }
            case "tll":
                return "Tallinn";

            case "copenhagen":
                if (abbr === true) {
                    return "CPH"
                }
			
			case "gev":
                return "Gallivare";
			case "gallivare":
			 if (abbr === true) {
                    return "GEV"
                }
            case "cph":
                return "Copenhagen";
			
			case "test":
                return "TEST STATION";
			
			

        }

    }


    function setHandoverData() {
		var insertToAnotherStation = {};
        data = {};

        data['Station'] = station;

        var staffs = new Array();
        $("input[name^='n_staff_name']").each(function() {
			var stId =$(this).attr('id')
			var staffShiftRecord = {}
			staffShiftRecord['name']= ($(this).val().trim());
			staffShiftRecord['startTime']=$('#'+stId+'_s').val();
			staffShiftRecord['endTime']=$('#'+stId+'_e').val();
			
			staffs.push(staffShiftRecord); 
        });
        data['Staff'] = staffs;

        var starttime = $("#start_time").val();
        data['Start Time'] = starttime;
        data['End Time'] = moment().format('DD-MMM HH:mm');
		data['Inventory Performed By'] =$("#n_staff_inv").val();

        var workperformed = {};
        var logisticsnote = new Array();
        var othercomments = new Array();


        $(".newhandover .workAircraftExpand").each(function() {
			
			var aircraftName = $(this).attr('id').toLowerCase();
            var task = new Array();
		
			$('td[id^=actionfromLastHandover_'+ aircraftName + ']').each(function() {
				var taskPerformed = new Array();				
				var byuser = ""; 
				if($(this).find('input[name^="action_staff_name"]').val()!=""){
					 byuser+=" by " + $(this).find('input[name^="action_staff_name"]').val();
				}
				
				var actionPerformed = $(this).find('input[id=action_select]').val();

				taskPerformed[0] = $(this).clone().find(".actionrequired").remove().end().text();
				taskPerformed[1] = actionPerformed + byuser + " " + moment().format('DD-MMM HH:mm');
				
				var noteID= ($(this).attr('id')).replace("actionfromLastHandover","td");
				var actiontitle = $("#"+noteID).find(".action_badge").html();
				
				var note =  $(this).find('.popovernote').attr('data-content') || "";
				var newNote = note.match(/(?<=noteId'>).*(?=<\/textarea>)/gm)||"";

				note = newNote +  note.replace(/<div(.|\n|\r)+div>/g,"");
				
				taskPerformed[2] = note;
				
				task.push(taskPerformed);
				if (RegExp("No action Required").test(actionPerformed)) {
					var reason= $(this).find('input[id=action_select_reason]').val()
					taskPerformed[1] = actionPerformed+ " due to "+ reason;
				}
				
			});		
			
			
            $("textarea[id ^='" + aircraftName + "_task_']").each(function() {
                var taskPerformed = new Array();

                var action = "";
                var check = $(this).closest("td").next().children("input").val()
                if (check == "true") {
                    action = "Action Required"
                }
                taskPerformed[0] = $(this).val().trim();
                taskPerformed[1] = action.trim();
                task.push(taskPerformed);
            });
			
			if(aircraftName!="logistics" && aircraftName!="comments" && aircraftName!="findings"){
				workperformed[aircraftName.toUpperCase()] = task;
			}
			
			else if(aircraftName =="comments"){
				data["Other Comments"]=task;
			}
			else if(aircraftName =="logistics"){
				data["Logistics Comments"]=task;
			}
			else if(aircraftName =="findings"){
				data["Inventory Findings"]=task;
			}
        });
        data['Work Performed On'] = workperformed;
        
		var newData={}
		newData['newrow']=data;
		newData['updateToStations']=insertToAnotherStation;
		
		console.log(newData);
		return newData;
    }					
	
	$(document).on("click", ".BackHandoverBtn", function() {
		$(".BackHandoverBtn").hide();
		$(".SaveHandoverBtn").hide();
		$(".ResetHandoverBtn").hide();
		$(".NewHandoverBtn").html(" Continue  " +"<i class=\"fa fa-chevron-right\" aria-hidden=\"true\"></i>").show();
        $(".viewhandover").show();
		$(".newhandover").hide();

		$('html,body').animate({
            scrollTop: 0
            }, 100);
			

    });
	
	$(document).on("click", ".SaveHandoverBtn", function() {
			saveData(station);

    });

    $(document).on("click",".NewHandoverBtn",function(event) {
        event.preventDefault();	
			$(".menubar").show()
			$(".NewHandoverBtn").hide();
			$(".BackHandoverBtn").show();
			$(".ResetHandoverBtn").show();
			$(".SaveHandoverBtn").show();
        	$(".viewhandover").hide();
        	$(".newhandover").show();
        	$('html,body').animate({
            scrollTop: 0
        	}, 700);
        
       

        
    });
	
	$(document).on("click",".ResetHandoverBtn",function(event) {
				var resetPage = localStorage.getItem("resetPage")
		
		$('.newhandover').empty().append(resetPage);
		$(".popovernote").popover({
					container: '.content',
					html: true
		});

		$('input[name^="n_staff_name"]').each(function(i, obj) {
			autocomplete("#"+$(obj).attr("id"),activeStaff);
		});
		
		$('div[id^="datetimepicker"]').each(function(i, obj) {
			formatDateTimePicker($(obj).attr("id"));
		});
		
	});
	$(document).on("click",".resetStation",function(event) {
        event.preventDefault();
		if(browser !=="ie"){
			localStorage.setItem("station","");
		}
		location.reload();

	});
	
	$(document).on("click",".browseTimeSheets",function(event) {
		 if(activeStaff =="" ){
				$.getJSON(sendTo + "?callback=?", {
				method: "getStaffList",
				},

				
					function(data) {
						activeStaff = data
						autocomplete("#search_name",activeStaff);
					});
			}
		
		event.preventDefault();
		$(".menubar").hide();
		$(".searchBar").show();
		$(".searchBar_button").show();
		$(".handoverHome").show();
		for(i=0;i<4;i++){
			$('.month').find(".dropdown-menu").append('<a class="dropdown-item" >'+moment().subtract(i, 'months').format('MMM YYYY')+'</a>');
		}
		
		
		$(".searchBar").find(".searchInfo").remove();
		$(".searchBar").append("<span class='badge badge-warning float-right searchInfo'> Time Sheet Browser</span>")
		$(".main").hide();
		$(".dataBrowser").empty();
		$(".dataBrowser").append("<span style='color:blue'>Contact station supervisor or helsinki planner if you do not have pin to access your timesheet </span>");
		$(".dataBrowser").show();
	});
	
	$(document).on("click",".browseHandover",function(event) {
		event.preventDefault();
		$(".handoverHome").show();
		$(".searchBar").show();
		$(".menubar").hide();
		$(".searchBar_button").hide()
		$(".searchBar").find(".searchInfo").remove();
		$(".searchBar").append("<span class='badge badge-warning float-right searchInfo'> Handover History</span>");
		$(".main").hide();
		$(".dataBrowser").empty();
		$.getJSON(sendTo + "?callback=?", {
            method: "getAllHandover",
        },function(data){
			$(".loader").hide();
			
			$(".dataBrowser").append("<table class='history_table  table table-sm table-bordered .table-condensed' id='th_table'><thead><tr><th>Date</th><th>Station</th><th>Shift </th></tr></thead><tbody></tbody></table>");
			
			
			for(var i =0;i < data.length;i++){
			
				if (i % 2 == 0){
					var style = "background:#f0f8ff;"
				}else{
					var style="";
				
				}
				var j=0;
				for(var station in data[i]['Station']){
					row = '<tr style='+style+'>'
					if(j==0){
						
						row =row +'<td style="vertical-align:middle;" rowspan='+Object.keys(data[i]['Station']).length+'>'+data[i]['Date']+'</td>'
					}
					row=row + '<td>'+station+'</td><td>'
					for (k in data[i]['Station'][station]){
						row=row+"<button class='btn btn-link btn-xs getHandover' value='"+data[i]['Station'][station][k][1]+"' data-toggle='modal' data-target='.bd-example-modal-lg'>"+data[i]['Station'][station][k][0]+"</button>"
					}
					
					row =row +"</td></tr>"
					j=j+1;
					$('.history_table tbody').append(row);
				}
				
			
			}
		
		});
		
		
		
		$(".dataBrowser").show();
	
	
	});
	
	$(document).on("click",".handoverHome",function(event) {
		event.preventDefault();
		$(".dataBrowser").empty();
		$(".menubar").show();
		$(".searchBar").hide();
		$(".handoverHome").hide();
		$(".main").show();
	});
	
	
	$(document).on("click",".help",function(event) {
		event.preventDefault();
		$(".handoverHome").show();
		$(".searchBar").show();
		$(".menubar").hide();
		$(".searchBar_button").hide()
		$(".searchBar").find(".searchInfo").remove();
		$(".searchBar").append("<span class='badge badge-warning float-right searchInfo'> Instructions to use</span>");
		$(".main").hide();
		$(".dataBrowser").empty();
		$(".dataBrowser").append('<iframe src='+ inst_Link +' width="100%" height="800px"></iframe>');
		$(".dataBrowser").show();
	});
	
	$(document).on("click",".getPin",function(event){
		$("#search_name").removeClass("error");
		$(".dataBrowser").empty();
		$(".month").removeClass("error");
		$("#pin").removeClass("error");
		var masterpin=$("#pin").val();
		var error =""
		
		var staff=$('#search_name').val();
		if(staff=="" || activeStaff.indexOf(staff) === -1 ){
			error ="Please select staff name from list"
			$(".dataBrowser").append("<span style='color:red'>"+error +"</span><br>");
			$("#search_name").addClass("error");
		}
		
		if(pin=="" || masterpin.length != 6){
		//console.log(pin.length);
			error ="Please enter valid Master Pin"
			$(".dataBrowser").append("<span style='color:red'>"+error +"</span><br>");
			$("#pin").addClass("error");
		}
		if(error!=""){
			return
		}
		$(".loader").show();
		
		$.getJSON(sendTo + "?callback=?", {
            method: "getPin",
            staff: staff,
			pin:masterpin,
        },function(data){
			$(".loader").hide();
			if(data[0]=="Pin Mismatch"){
				$(".dataBrowser").append("<div class='alert alert-danger'>Master Pin could not be verified, contact helsinki planner for assistance</div>");
				return;
			}
			//console.log(data);
			$(".dataBrowser").append("<div style='width:100%;text-align:center'><h1><span style='color:red'>"+data[0] +"</span></h1></div>");
			
		
		});
		
		
		
	
	});
	$(document).on("click",".ts_print",function(event){
		var printContents = $(".content").clone();
            var myWindow = window.open( '', "Time sheet ", "menubar=0,location=0,height=700,width=700" );
            
			$(printContents).prepend('<head><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" /></head>');

            $(printContents).find(".searchBar").hide();
			$(printContents).find(".top-navbar").hide();
			$(printContents).find(".searchBar").hide();
			$(printContents).find(".ts_print").hide();
			$(printContents).find(".title").html('<b>Staff: </b>'+ $('#search_name').val()+ "<b> Month: </b>"+$(".month").find("button").text());
			$(printContents).find(".table").addClass("table-sm").css("fontsize","x-small");
			$(printContents).appendTo( myWindow.document.body );;
			
			$(printContents).find("button").each(function(){
			 $(this).closest("td").empty().append($(this).text());
			
			})
			
			
			var fakeListener = setInterval(function(){
			if($(printContents).find(".table").css("border-collapse")=== "collapse"){
				clearInterval(fakeListener)
				myWindow.print();
				myWindow.close();
				}
			},50)
			
			
			
			
	
	});
	
	
	$(document).on("click",".search",function(event){
		event.preventDefault();
		
		$("#search_name").removeClass("error");
		$(".month").removeClass("error");
		$("#pin").removeClass("error");
		$(".dataBrowser").empty();
		var pin=$("#pin").val();
		var error =""
		var month= $(".month").find("button").text();

		var staff=$('#search_name').val();
		if(staff=="" || activeStaff.indexOf(staff) === -1 ){
			error ="Please select staff name from list"
			$(".dataBrowser").append("<span style='color:red'>"+error +"</span><br>");
			$("#search_name").addClass("error");
		}
		
		if(pin=="" ){
			error ="Please enter Pin"
			$(".dataBrowser").append("<span style='color:red'>"+error +"</span><br>");
			$("#pin").addClass("error");
		}
		
		
		if(month.trim()=="Select Month"){
			error ="Please select a Month"
			$(".dataBrowser").append("<span style='color:red'>"+error +"</span><br>");
			$(".month").addClass("error");
		}
		
		
		if(error!=""){
			return
		}
		$(".loader").show();
		

		$.getJSON(sendTo + "?callback=?", {
            method: "getTimeSheet",
            staff: staff,
			pin:pin,
			month: month.split(" ")[0],
        },function(data){
			$(".loader").hide();
			if(data[0]=="Pin Mismatch"){
				$(".dataBrowser").append("<div class='alert alert-danger'>Pin Mismatch, contact station supervisor or helsinki planner for correct Pin</div>");
				return;
			}
			var monthNum = new Date(Date.parse(month.split(" ")[0] +" 0",month.split(" ")[1])).getMonth();	
			var daysInMonth = new Date(month.split(" ")[1], (monthNum + 1), 0).getDate();
			
			if(data.length==0){
				$(".dataBrowser").append("<div class='alert alert-danger'>Oops! Could not find anything for " + staff+ " on  "+ month +"</div>");
			}
			else{
				
				$(".dataBrowser").append("<div class='alert alert-warning'>Disclaimer: The timesheet is automatically generated based on the data from Shift Handovers<br>This cannot be considered as official proof of working hours.</div>");
				$(".dataBrowser").append("<table class='timesheet_table  table table-striped table-bordered .table-condensed' id='ts_table'><thead><tr><th>Date</th><th>Shift/Handover File</th><th>Start Time</th><th>End TIme</th><th>Station</th><th>Total Hours <button class='btn btn-link btn-xs float-right ts_print'> <i class='fas fa-print'> Print</i></button></th></tr></thead><tbody></tbody></table>");
				
				var days = ['<span style="color:red">Sun</span>', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', '<span style="color:red">Sat</span>'];
				
				for(var i = 1; i<=daysInMonth;i++){
					var day = (new Date(month.split(" ")[1],monthNum,i)).getDay();
					$('.timesheet_table tbody').append("<tr><td id='day_"+i+"'>"+i+"   "+days[day]+"</td><td id='shift_"+i+"'></td><td id='starttime_"+i+"'></td><td id='endtime_"+i+"'></td><td id='station_"+i+"'></td><td id='totalh_"+i+"'></td></tr>")
				}
				
				var actualStartTime="";
				var dayRowNo="";
				for (var i=data.length-1;i>=0;i--){
				
					var startDateTime = data[i][1];
					var endDateTime = data[i][2];
					if(startDateTime !="Continued from Last Shift"){
						actualStartTime = moment(startDateTime);
						dayRowNo = actualStartTime.date();					
					
					if(endDateTime !="Continued to Next Shift"){
			
						$("#starttime_"+dayRowNo).append("<div>"+actualStartTime.format("HH:mm")+"</div>");
						$("#endtime_"+dayRowNo).append("<div>"+moment(endDateTime).format("HH:mm")+"</div>");
						$("#totalh_"+dayRowNo).append("<div>"+Math.round(moment.duration(moment(endDateTime).diff(actualStartTime)).asHours() * 100) / 100+"</div>");
						
						$("#shift_"+dayRowNo).append("<div><button class='btn btn-link btn-xs getHandover' value='"+data[i][4]+"' data-toggle='modal' data-target='.bd-example-modal-lg'>"+data[i][0]+"</button></div>");
						
						
						if(!RegExp(data[i][3]).test($("#station_"+dayRowNo).text())){
							$("#station_"+dayRowNo).append("<div>"+data[i][3]+"</div>")
							//console.log($("#station_"+dayRowNo).text());
						}
						actualStartTime="";
						dayRowNo="";
					}else{

						$("#starttime_"+dayRowNo).append("<div>"+actualStartTime.format("HH:mm")+"</div>");
						
						$("#shift_"+dayRowNo).append("<div><button class='btn btn-link btn-xs getHandover' value='"+data[i][3]+"' data-toggle='modal' data-target='.bd-example-modal-lg'>"+data[i][0]+"/button></div>");
						
						if(!RegExp(data[i][3]).test($("#station_"+dayRowNo).text())){
							$("#station_"+dayRowNo).append("<div>"+data[i][3]+"</div>")
							//console.log($("#station_"+dayRowNo).text());
						}
					}	
				}else{

					
					if(endDateTime !="Continued to Next Shift"){
						$("#endtime_"+dayRowNo).append("<div>"+moment(endDateTime).format("HH:mm")+"</div>");
						$("#shift_"+dayRowNo).append("<div><button class='btn btn-link btn-xs getHandover' value='"+data[i][4]+"' data-toggle='modal' data-target='.bd-example-modal-lg'>"+data[i][0]+"</button></div>");
						
						
						
						
						$("#totalh_"+dayRowNo).append("<div>"+Math.round(moment.duration(moment(endDateTime).diff(actualStartTime)).asHours() * 100) / 100+"</div>");
						if(!RegExp(data[i][2]).test($("#station_"+dayRowNo).text())){
							$("#station_"+dayRowNo).append("<div>"+data[i][3]+"</div>")
							//console.log($("#station_"+dayRowNo).text());
						}
					
					}else{
						$("#starttime_"+dayRowNo).html("<div>"+actualStartTime.format("HH:mm")+"</div>");
						
						$("#shift_"+dayRowNo).append("<div><button class='btn btn-link btn-xs getHandover' value='"+data[i][4]+"' data-toggle='modal' data-target='.bd-example-modal-lg'>"+data[i][0]+"</button></div>");
						
						
						if(!RegExp(data[i][2]).test($("#station_"+dayRowNo).text())){
							$("#station_"+dayRowNo).append("<div>"+data[i][3]+"</div>")
							//console.log($("#station_"+dayRowNo).text());
						}
					}
				}
			}
			}
		})
	
	
	
	
	
	})
	
	$(document).on("click",".getHandover",function(event){
			$('#testmodel').modal();
			$('.handoverViewer').empty()
			$('.handoverViewer').append($('.loader').clone());
			$('.handoverViewer .loader' ).show();
			var handoverId =$(this).val();
			
			$.getJSON(sendTo + "?callback=?", {
                method: "getHandoverById",
                handoverId: handoverId
				},
				function(data) {
					//console.log(data);
					$('.handoverViewer').empty();
					$('.handoverViewer').append(data);
			})
	
	
	});
	
	$(document).on("click",".closeAlert",function(event) {
        $(this).closest(".successAlert").remove();
		window.print();
		location.reload();
	});

    $(document).on("click",".newhandoverSubmit",function(event) {
        event.preventDefault();	
		if(validateInputs("newhandover")){
				var data = setHandoverData();
				$('#loading_text').text("Updating new Handover");
				$('.main').hide();
				$('.loader').show();
				console.log(data['newrow']);
			   $.getJSON(sendTo + "?callback=?", {
                method: "update",
                newrow: JSON.stringify(data['newrow']),
                updateToStations: JSON.stringify(data['updateToStations'])
				
            },

            function(data) {
			
				//console.log(data);
				$('.menubar').hide();
				$(".preview").append(data['Html']);
				$('#hdiv').empty();
				$(".preview").append("<br/><hr><b>Feedback (if applicable)</b>");
				$(".preview").show();
				$('.loader').hide();
				$('.main').hide();
				$('.top-navbar').hide();
				$("#emailConfirm").html(data['Email Confirm'])
				$(".successAlert").show();
				$(".back").remove();
				
				$(".container").css('margin-left','50px');
				
				
		});
		
		}

    });
	
	var nextRow_enter=true;
	
	$(document).on("keyup","textarea,input[type=text]",function (event) {
		//console.log(event.keyCode +"   "+nextRow_enter);
		var check = $(".autocomplete-items").length;
			if (event.keyCode == 13 && nextRow_enter === true){
					//console.log("next enabled")
					var rowBtn = $(this).closest("tbody").find(".add_Row");
					rowBtn.trigger("click");
				}
					nextRow_enter = true;
					
	});
	
	
	$(document).on("focusout","input[type=text]",function (event) {
					if($(this).attr("id").match(/staff/)){
						
					if(activeStaff.indexOf($(this).val()) === -1) {
						  activeStaff.push($(this).val());
					  }
					}
					
	});
	


	
	function validateInputs(className){
    	var check=true;
    	$('.errormessage').remove();
		$("#n_staff_inv").removeClass("error");
		$("tr").removeClass("error");
    	$('input').each(function(i, obj) {
			var errormessage ="";
			var inputId=$(obj).attr("id");
    		
			if($(obj).val()=="" && $(obj).prop('required')){
    				if(inputId=="action_select_reason"){
    					errormessage ="You must select a reason";
    				}
					if(inputId=="action_select"){
    					errormessage ="You must select an Action";
    				}
					
					if(inputId.match(/^(n_staff_)\d+$/g)!=null){
						errormessage="Please enter staff name"
					}		
    			}
				
			if(inputId=="start_time"){
				var d = moment($(obj).val(), 'DD-MMM HH:mm')
				if(d.isValid()){
					if(d>moment()){
						errormessage="Start time cannot be in future"
					}
					if(d <moment().subtract(24,"hours")){
						errormessage="Start Time cannot be more than 24 hrs ago"
					}
				}else {			
					errormessage="Please enter valid Shift start date time"
				}
			}
			
			if(inputId.match(/(n_staff_)\d+(_s)/g)!=null){
				
				var sd =$(obj).val();
				
				if(sd !="" && sd!="Continued from Last Shift"){
				    sd = moment($(obj).val(), 'DD-MMM HH:mm');
					var differ= moment.duration(moment().diff(sd));
					if(differ.asHours()>24){
						errormessage ="Start Time cannot be more than 24 hrs ago"
					}
					
					if(sd > moment()){
						errormessage ="Start Time cannot be in future"
					}	
				}
			}
					
			if(inputId.match(/(n_staff_)\d+(_e)/g)!=null){
				var sd = moment($(obj).closest(".date").prev().find("input").val(),'DD-MMM HH:mm')
				
				if($(obj).val()!="" && $(obj).val()!="Continued to Next Shift"){
					var ed = moment($(obj).val(), 'DD-MMM HH:mm');
					if(ed > moment()){
						errormessage ="End time cannot be in future"
					}
					
					if(sd.isValid()){
						//console.log(sd);
						if(ed < sd ){
						errormessage ="End time cannot less than Start Time"
						}
					}
					
					else {
						//console.log(moment($('#start_time').val(),'DD-MMM HH:mm' ));
						if(ed < moment($('#start_time').val(),'DD-MMM HH:mm' )){
						errormessage ="End time cannot less than Shift Start Time"
					}
					}
				}
			
			}
			
			if(errormessage!=""){
				$(obj).closest('td').prepend("<span class=\"errormessage row\">"+errormessage+" <\/span>").closest('tr').addClass("error");
				check=false;
			}
			
			if($(obj).val()=="" && inputId=="n_staff_inv"){
    					errormessage ="Please specify who performed the inventory";
						$(obj).closest('.autocomplete').prepend("<span class=\"errormessage row\">"+errormessage+" <\/span>");
						$(obj).addClass("error");
						check=false;
    				}

    	});
		
		$('textarea').each(function(i, obj) {
				var errormessage ="";
				if($(obj).val()=="" && $(obj).prop('required')){
					errormessage ="Please fill in this field";
					if ($(obj).attr("name")=="task_note"){
					 errormessage="Please fill in note";
					}
					$(obj).closest('td').prepend("<span class=\"errormessage errnote row\">"+errormessage+" <\/span>");
					$(obj).addClass("error");
					check=false;
				}
		
		});
		if(!check)
		
		{
		$('.'+className).effect( "bounce", "slow" )
		$( ".error")[0].scrollIntoView();
		}
		
    	return check;
    }
		
		
	function checkCurrentVersion(){
		
		var a = $.getJSON(sendTo + "?callback=?", {
            method: "getVersion",
        },
		
        function(data) {
			test = data['Test Version']
			var latestVersion = data['version'];
			var documentVersion = ($(".version").text()).slice(9);
			if(documentVersion != latestVersion){
				var modelText = data['message'];
				$(".successAlert .modal-title").removeClass("text-success").addClass("text-warning").html("Please Update");
				$(".successAlert .modal-body").empty().append(modelText);
				$(".closeAlert").addClass("versionCheckClose").removeClass("closeAlert");
				$(".versionCheckClose").html("Download");
			
				$(document).on("click",".versionCheckClose",function(){
					window.location.replace(data['location']);
					$(".successAlert .modal-body").empty().append("Handover_v."+latestVersion+" has been downloaded, Please reopen the downloaded file on other tab/window");
					$(".versionCheckClose").hide();
				})
			
				$(".successAlert").show();
			}
			else{
				
				showStationChooser();
			}
		});	
	}
	displayCurrentTime();
	
	function showStationChooser(){
		
		$(".chooseStation").show();
		station=localStorage.getItem("station");
		
		if(station && station !="null" && station!="" ){
					$('#station').html(stationAbbr(station, false)+" <a class=\"resetStation\" href=\"#\" style=\"font-weight:normal\"></a>");
					loadHandoverPage(station);		
		}
		/*testing enabled*/
		if(test==true){
		var testStation= "<div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"radio\" name=\"radioButtonStation\" id=\"inlineRadio3\" value=\"TEST\"><label class=\"form-check-label\" for=\"inlineRadio3\">TEST  <\/label></div>"
			$(".stationselect").append(testStation);
			station ="TEST";
		}
	}
	
	function displayCurrentTime() {
		var currentTime = moment().format("DD/MM/YYYY <br> HH:mm:ss");
		$(".clockTime").html(currentTime);
		var t = setTimeout(displayCurrentTime, 500);
	}
	
	function checkSavedData(Station){
		
		var savedData = localStorage.getItem("savedData")
		/*var reset = localStorage.getItem("reset")*/
		//console.log(savedData)
		if(savedData != "" && savedData != null/* & (reset ==null||reset ==) */){
			var data = JSON.parse(savedData);
			
			if(data['LastHandoverId']!= handoverId){
				localStorage.setItem("savedData","");
				return "";
			}
			return data; 
		}
		return "";
	}
	
	function saveData(Station){
		var toSaveData ={}
		var toSaveValue ={}
		var toSaveHtml =$('.newhandover').html()
		
		var savedValues = {};   	
		$('.newhandover input,textarea').each(function(i, obj) {
			var inputId=$(obj).attr("id");
			toSaveValue[inputId]= $(obj).val()
		});
		toSaveData['LastHandoverId']= handoverId;
		toSaveData['station']=Station;
		toSaveData['htmldata']=toSaveHtml;
		toSaveData['values']=toSaveValue;
		toSaveData['LastHandover']= $('.viewhandover').html();
	
		var save = JSON.stringify(toSaveData);
		
		localStorage.setItem("savedData",save);
		
		var alert = "<div class=\"alert customAlert alert-info alert-dismissible fade show\" role=\"alert\"><strong>Saved!</strong> Note that it is only saved on this computer and will be deleted as handover is submitted.<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>"
		
		$(alert).insertAfter($('.menubar'));
		$('.alert').alert()
		
		var test = localStorage.getItem("savedData");
	}
	
	function formatDateTimePicker(id){
	
	if(id.match(/datetimepicker_s/)){
		$('#'+id).datetimepicker({
			toolbarPlacement:"top",
			sideBySide:true,
			format: 'DD-MMM HH:mm',
			autoClose: true,
			buttons: {
				showClear: true,
			},
			tooltips: {
				clear: 'Select if Continued  from last Shift',
			},
			icons:{
				clear: "btn btn-xs btn-primary fromLastShift "
			}
		})
	}
	
	
	if(id.match(/datetimepicker_e/)){
		
		$('#'+id).datetimepicker({
			toolbarPlacement:"top",
			format: 'DD-MMM HH:mm',
			sideBySide:true,
			autoClose: true,
			defaultDate:"",
			buttons: {
				showClear: true,
			},
			tooltips: {
				clear: 'Select if Continued  to next shift',
			},
			icons:{
				clear: "btn btn-xs btn-primary toNextShift"
			}
		})
	}
	else{
		$('#'+id).datetimepicker({
			format: 'DD-MMM HH:mm',
			sideBySide:true,
			autoClose: true,
			defaultDate:"",
		})
	
	
	
	}
	
	}


	function autocomplete(inp, arr) {
		  /*the autocomplete function takes two arguments,
		  the text field element and an array of possible autocompleted values:*/
		  var currentFocus;
		  /*execute a function when someone writes in the text field:*/
		 
		  $(document).on("input",inp,function(e) {
			  var a, b, i, val = this.value;
			  /*close any already open lists of autocompleted values*/
			  closeAllLists();
			  if (!val) { return false;}
			  currentFocus = -1;
			  /*create a DIV element that will contain the items (values):*/
			  a = document.createElement("DIV");
			  a.setAttribute("id", this.id + "autocomplete-list");
			  a.setAttribute("class", "autocomplete-items");
			  /*append the DIV element as a child of the autocomplete container:*/
			  this.parentNode.appendChild(a);
			  /*for each item in the array...*/
			  for (i = 0; i < arr.length; i++) {
				/*check if the item starts with the same letters as the text field value:*/
				if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
				  /*create a DIV element for each matching element:*/
				  b = document.createElement("DIV");
				 
				  /*make the matching letters bold:*/
				  b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
				  b.innerHTML += arr[i].substr(val.length);
				  /*insert a input field that will hold the current array item's value:*/
				  b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
				  /*execute a function when someone clicks on the item value (DIV element):*/
					 $(b).bind( "click",function(e) {
					  /*insert the value for the autocomplete text field:*/
					  $(inp).val(this.getElementsByTagName("input")[0].value)
					  
					  /*close the list of autocompleted values,
					  (or any other open lists of autocompleted values:*/
					  closeAllLists();
					  
				  });
				  a.appendChild(b);
				}else{
					
				}
			  }
		  });
		  /*execute a function presses a key on the keyboard:*/
		  $(document).on("keydown",inp, function(e) {
			  var x = document.getElementById(this.id + "autocomplete-list");
			  if (x) x = x.getElementsByTagName("div");
			  if (e.keyCode == 40) {
				/*If the arrow DOWN key is pressed,
				increase the currentFocus variable:*/
				currentFocus++;
				/*and and make the current item more visible:*/
				addActive(x);
			  } else if (e.keyCode == 38) { //up
				/*If the arrow UP key is pressed,
				decrease the currentFocus variable:*/
				currentFocus--;
				/*and and make the current item more visible:*/
				addActive(x);
			  } else if (e.keyCode == 13) {
				
				/*If the ENTER key is pressed, prevent the form from being submitted,*/
				e.preventDefault();
				if (currentFocus > -1) {
				  /*and simulate a click on the "active" item:*/
				  if (x){
					nextRow_enter = false;
					x[currentFocus].click();
					//$(inp).val(x[currentFocus].getElementsByTagName("input")[0].value)
					closeAllLists();
					
				  }
				}
			  }
		  });
		  function addActive(x) {
			/*a function to classify an item as "active":*/
			if (!x) return false;
			/*start by removing the "active" class on all items:*/
			removeActive(x);
			if (currentFocus >= x.length) currentFocus = 0;
			if (currentFocus < 0) currentFocus = (x.length - 1);
			/*add class "autocomplete-active":*/
			x[currentFocus].classList.add("autocomplete-active");
		  }
		  function removeActive(x) {
			/*a function to remove the "active" class from all autocomplete items:*/
			for (var i = 0; i < x.length; i++) {
			  x[i].classList.remove("autocomplete-active");
			}
		  }
		  function closeAllLists(elmnt) {
			/*close all autocomplete lists in the document,
			except the one passed as an argument:*/
			var x = document.getElementsByClassName("autocomplete-items");
			for (var i = 0; i < x.length; i++) {
			  if (elmnt != x[i] && elmnt != inp) {
			  x[i].parentNode.removeChild(x[i]);
			}
		  }
		}
		/*execute a function when someone clicks in the document:*/
		 $(document).on("click",inp, function (e) {
			closeAllLists(e.target);
			
		});
}

});
       

</script>
</html>
